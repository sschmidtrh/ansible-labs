<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Lab: Getting Started with Ansible</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Lab: Getting Started with Ansible</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_your_lab_environment">1. Your Lab Environment</a>
<ul class="sectlevel2">
<li><a href="#_deploy_your_lab_environment">1.1. Deploy your Lab Environment</a></li>
<li><a href="#_access_your_lab_environment">1.2. Access your Lab Environment</a></li>
</ul>
</li>
<li><a href="#_check_the_prerequisites">2. Check the Prerequisites</a>
<ul class="sectlevel2">
<li><a href="#_working_the_labs">2.1. Working the Labs</a></li>
<li><a href="#_challenge_labs">2.2. Challenge Labs</a></li>
</ul>
</li>
<li><a href="#_getting_started_with_ansible">3. Getting Started with Ansible</a>
<ul class="sectlevel2">
<li><a href="#_the_inventory">3.1. The Inventory</a></li>
<li><a href="#_the_ansible_configuration_files">3.2. The Ansible Configuration Files</a></li>
</ul>
</li>
<li><a href="#_running_ansible_ad_hoc_commands">4. Running Ansible Ad-Hoc Commands</a>
<ul class="sectlevel2">
<li><a href="#_listing_modules_and_getting_help">4.1. Listing Modules and Getting Help</a></li>
<li><a href="#_more_ad_hoc_commands">4.2. More Ad Hoc Commands</a></li>
<li><a href="#_challenge_lab_modules">4.3. Challenge Lab: Modules</a></li>
</ul>
</li>
<li><a href="#_ansible_playbooks_introduction">5. Ansible Playbooks: Introduction</a>
<ul class="sectlevel2">
<li><a href="#_playbook_basics">5.1. Playbook Basics</a></li>
</ul>
</li>
<li><a href="#_your_first_playbook">6. Your first Playbook</a>
<ul class="sectlevel2">
<li><a href="#_playbook_install_apache">6.1. Playbook: Install Apache</a></li>
<li><a href="#_running_playbooks">6.2. Running Playbooks</a></li>
<li><a href="#_extend_your_playbook_start_enable_apache">6.3. Extend your Playbook: Start &amp; Enable Apache</a></li>
<li><a href="#_extend_your_playbook_create_an_index_html">6.4. Extend your Playbook: Create an index.html</a></li>
<li><a href="#_challenge_lab_playbooks">6.5. Challenge Lab: Playbooks</a></li>
</ul>
</li>
<li><a href="#_ansible_variables">7. Ansible Variables</a>
<ul class="sectlevel2">
<li><a href="#_introduction">7.1. Introduction</a></li>
<li><a href="#_off_to_the_lab">7.2. Off to the Lab</a></li>
<li><a href="#_create_the_variable_files">7.3. Create the Variable Files</a></li>
<li><a href="#_create_index_html_files">7.4. Create index.html Files</a></li>
<li><a href="#_create_the_playbook">7.5. Create the Playbook</a></li>
<li><a href="#_test_the_result">7.6. Test the Result</a></li>
</ul>
</li>
<li><a href="#_ansible_facts">8. Ansible Facts</a>
<ul class="sectlevel2">
<li><a href="#_challenge_lab_facts">8.1. Challenge Lab: Facts</a></li>
<li><a href="#_using_facts_in_playbooks">8.2. Using Facts in Playbooks</a></li>
</ul>
</li>
<li><a href="#_ansible_conditionals">9. Ansible Conditionals</a>
<ul class="sectlevel2">
<li><a href="#_inventory_group_membership_in_conditional">9.1. Inventory Group Membership in Conditional</a></li>
<li><a href="#_challenge_lab_fact_in_conditional">9.2. Challenge Lab: Fact in Conditional</a></li>
</ul>
</li>
<li><a href="#_ansible_handlers">10. Ansible Handlers</a></li>
<li><a href="#_ansible_templates">11. Ansible Templates</a>
<ul class="sectlevel2">
<li><a href="#_using_templates_in_playbooks">11.1. Using Templates in Playbooks</a></li>
<li><a href="#_challenge_lab">11.2. Challenge Lab</a></li>
</ul>
</li>
<li><a href="#_the_end">12. The End</a></li>
<li><a href="#_bonus_labs">13. Bonus Labs</a>
<ul class="sectlevel2">
<li><a href="#_bonus_lab_ad_hoc_commands">13.1. Bonus Lab: Ad Hoc Commands</a></li>
<li><a href="#_bonus_lab_templates_and_variables">13.2. Bonus Lab: Templates and Variables</a></li>
<li><a href="#_change_a_configuration_file">13.3. Change a Configuration File</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_your_lab_environment">1. Your Lab Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab you work in a pre-configured lab environment.
You will have access to the following hosts:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Hostname Ext</th>
<th class="tableblock halign-left valign-top">Hostname Int</th>
<th class="tableblock halign-left valign-top">Internal IP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="verse">Jump Host &amp; Ansible Control Host</div></td>
<td class="tableblock halign-left valign-top"><div class="verse">control-&lt;GUID&gt;.rhpds.opentlc.com</div></td>
<td class="tableblock halign-left valign-top"><div class="verse">control.example.com</div></td>
<td class="tableblock halign-left valign-top"><div class="verse">192.168.0.10</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="verse">Managed Host 1</div></td>
<td class="tableblock halign-left valign-top"><div class="verse"></div></td>
<td class="tableblock halign-left valign-top"><div class="verse">host1.example.com</div></td>
<td class="tableblock halign-left valign-top"><div class="verse">192.168.0.20</div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="verse">Managed Host 2</div></td>
<td class="tableblock halign-left valign-top"><div class="verse"></div></td>
<td class="tableblock halign-left valign-top"><div class="verse">host2.example.com</div></td>
<td class="tableblock halign-left valign-top"><div class="verse">192.168.0.30</div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You will be able to SSH into the control host, from here you need to SSH into the other hosts.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_deploy_your_lab_environment">1.1. Deploy your Lab Environment</h3>
<div class="paragraph">
<p>Your lab environment has already been deployed for you.
Please use the GUID that was assigned to you.</p>
</div>
</div>
<div class="sect2">
<h3 id="_access_your_lab_environment">1.2. Access your Lab Environment</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Every seat has been assigned a GUID.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To find your GUID open this web page in your browser:</p>
</div>
<div class="paragraph">
<p><strong><a href="https://github.com/sschmidtrh/ansible-labs/blob/master/lab_list.txt" class="bare">https://github.com/sschmidtrh/ansible-labs/blob/master/lab_list.txt</a></strong></p>
</div>
<div class="paragraph">
<p>To access your control host:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Look up your <strong>GUID</strong></p>
</li>
<li>
<p>Open a terminal session</p>
</li>
<li>
<p>Log in to your control host as lab-user using the hostname, the password will be given by the instructor.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The hostname is: <strong>control-&lt;GUID&gt;.rhpds.opentlc.com</strong>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Replace &lt;GUID&gt; with the GUID assigned to you!</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example: If your GUID is "83d4", do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ssh lab-user@control-83d4.rhpds.opentlc.com</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_check_the_prerequisites">2. Check the Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most prerequisite tasks have already been done for you:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ansible software is installed</p>
</li>
<li>
<p>SSH connection and keys are configured</p>
</li>
<li>
<p><code>sudo</code> has been configured on the managed hosts to run commands that require root privileges.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check Ansible has been installed correctly</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@control ~]# ansible --version
ansible 2.5.0
  config file = /etc/ansible/ansible.cfg
[...]</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ansible is keeping configuration management simple. Ansible requires no database or running daemons and can run easily on a laptop. On the managed hosts it needs no running agent.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Verify that the managed hosts accept password-less connections with key authentication from the control node as user ansible, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[root@control ~]# su - ansible
[ansible@control ~]$ ssh host1.example.com
[ansible@host1 ~]$ exit</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ~]$ ssh host2.example.com
[ansible@host2 ~]$ exit</pre>
</div>
</div>
<div class="paragraph">
<p>To allow user ansible to execute commands on host1.example.com and host2.example.com as root <code>sudo</code> needs to be configured on the managed hosts.</p>
</div>
<div class="paragraph">
<p>Test that the configuration allows ansible to run commands using <code>sudo</code> on host1.example.com and host2.example.com without a password, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ~]$ ssh host1.example.com
[ansible@host1 ~]$ sudo cat /etc/shadow
[ansible@host1 ~]$ exit</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>In all subsequent exercises you should work as the ansible user on the control node if not explicitly told differently.</strong>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_working_the_labs">2.1. Working the Labs</h3>
<div class="paragraph">
<p>You might have guessed by now this lab is pretty commandline-centric&#8230;&#8203; :-)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t type everything manually, use copy &amp; paste from the browser when appropriate. But don&#8217;t stop to think and understand&#8230;&#8203; ;-)</p>
</li>
<li>
<p>All labs where prepared using Vi, but feel free to use mc (function keys can be reached via Esc-&lt;n&gt;) or nano.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In the lab guide commands you are supposed to run are shown with or without the expected output, whatever makes more sense in the context.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The command line can wrap on the web page from time to time. Therefor the output is separated from the command line for better readability by an empty line. <strong>Anyway, the line you should actually run should be recognizable by the prompt.</strong> :-)
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_challenge_labs">2.2. Challenge Labs</h3>
<div class="paragraph">
<p>You will soon discover that many chapters in this lab guide come with a "Challenge Lab" section. These labs are meant to give you a small task to solve using what you have learned so far. The solution of the task is shown underneath a warning sign.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started_with_ansible">3. Getting Started with Ansible</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_inventory">3.1. The Inventory</h3>
<div class="paragraph">
<p>To use the ansible command for host management, you need to provide an inventory file which defines a list of hosts to be managed from the control node. One way to do this is to specify the path to the inventory file with the <code>-i</code> option to the ansible command.</p>
</div>
<div class="paragraph">
<p>Make sure you are user ansible on control.example.com. Create a directory for your Ansible files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ~]$ mkdir ansible-files</pre>
</div>
</div>
<div class="paragraph">
<p>Now create a simple inventory file as <code>~/ansible-files/inventory</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>host1.example.com
host2.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>To reference inventory hosts, you supply a host pattern to the ansible command. Ansible has a <code>--list-hosts</code> option which can be useful for clarifying which managed hosts are referenced by the host pattern in an ansible command.</p>
</div>
<div class="paragraph">
<p>The most basic host pattern is the name for a single managed host listed in the inventory file. This specifies that the host will be the only one in the inventory file that will be acted upon by the ansible command. Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ~]$ ansible "host1.example.com" -i ~/ansible-files/inventory --list-hosts

  hosts (1):
    host1.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>An inventory file can contain a lot more information, it can organize your hosts in groups or define variables. You will use grouping most of the times, change your inventory file to look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[webserver]
host1.example.com

[database]
host2.example.com

[ftpserver]
host2.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Now run Ansible with these host patterns and observe the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ~]$ ansible webserver -i ~/ansible-files/inventory --list-hosts
[ansible@control ~]$ ansible webserver,host2.example.com -i ~/ansible-files/inventory --list-hosts
[ansible@control ~]$ ansible '*.example.com' -i ~/ansible-files/inventory --list-hosts
[ansible@control ~]$ ansible all -i ~/ansible-files/inventory --list-hosts</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is ok to put systems in more than one group, for instance a server could be both a web server and a database server.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The inventory can contain more data. E.g. if you have hosts that run on non-standard SSH ports you can put the port number after the hostname with a colon. Or you could define names specific to Ansible and have them point to the "real" IP or hostname.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_ansible_configuration_files">3.2. The Ansible Configuration Files</h3>
<div class="paragraph">
<p>The behavior of Ansible can be customized by modifying settings in Ansible&#8217;s ini-style configuration file. Ansible will select its configuration file from one of several possible locations on the control node, please refer to the documentation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The recommended practice is to create an <code>ansible.cfg</code> file in a directory from which you run Ansible commands. This directory would also contain any files used by your Ansible project, such as the inventory and Playbooks.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Make sure your inventory file is used by default when executing commands from the <code>~/ansible-files/</code> directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On control.example.com as ansible create the file <code>~/ansible-files/ansible.cfg</code> with the following content:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[defaults]
inventory=/home/ansible/ansible-files/inventory</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Check with <code>ansible --version</code>, first from ansible&#8217;s home directory and then from <code>~/ansible-files/</code>. You should find when run from <code>~/ansible-files/</code> your personal config settings override the main config file.</p>
</li>
<li>
<p>From <code>~/ansible-files/</code> run <code>ansible all --list-hosts</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your Ansible inventory was used without providing the <code>-i</code> option. To double-check, run the command again from outside <code>~/ansible-files/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control-6656 ~]$ ansible all --list-hosts

 [WARNING]: provided hosts list is empty, only localhost is available. Note that
the implicit localhost does not match 'all'

  hosts (0):</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_ansible_ad_hoc_commands">4. Running Ansible Ad-Hoc Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible allows administrators to execute on-demand tasks on managed hosts. These ad hoc commands are the most basic operations that can be performed with Ansible. They are great for learning about Ansible, for trying new things or for quick non-intrusive tasks like reporting. Let&#8217;s try something straight forward:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Don&#8217;t forget to run the commands from <code>~/ansible-files/</code> where your <code>ansible.cfg</code> file is located, otherwise it will complain about an empty host list.</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run the examples on control.example.com from the <code>~/ansible-files/</code> directory as user ansible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible all -m ping</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>-m</code> option defines which Ansible module to use. Options can be passed to the specified modul using the <code>-a</code> option. BTW the <code>ping</code> module is not running an ICMP ping but does a simple connection test.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Think of a module as a tool which is designed to accomplish a specific task.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_listing_modules_and_getting_help">4.1. Listing Modules and Getting Help</h3>
<div class="paragraph">
<p>Ansible comes with a lot of modules by default. To list all modules run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-doc -l</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In <code>ansible-doc</code> use the <code>up</code>/<code>down</code> arrows to scroll through the content and leave with <code>q</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To find a module try e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-doc -l | grep -i user</pre>
</div>
</div>
<div class="paragraph">
<p>Get help for a specific module including usage examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-doc user</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Mandatory options are marked by a "=" in <code>ansible-doc</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_more_ad_hoc_commands">4.2. More Ad Hoc Commands</h3>
<div class="paragraph">
<p>Let&#8217;s try a simple module that just executes a command on a managed host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m command -a 'id'

host1.example.com | SUCCESS | rc=0 &gt;&gt;
uid=1000(ansible) gid=1000(ansible) groups=1000(ansible),10(wheel) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</pre>
</div>
</div>
<div class="paragraph">
<p>In this case the module is called <code>command</code> and the option passed with <code>-a</code> is the actual command to run. Try to run this ad hoc command on both hosts using the <code>all</code> host pattern.</p>
</div>
<div class="paragraph">
<p>Another example: Have a quick look at the kernel versions your hosts are running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible all -m command -a 'uname -r'</pre>
</div>
</div>
<div class="paragraph">
<p>Sometimes it&#8217;s desirable to have the output for a host on one line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible all -m command -a 'uname -r' -o</pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>copy</code> module, execute an ad hoc command on control.example.com to change the contents of the <code>/etc/motd</code> file on host1.example.com. <strong>The content is handed to the module through an option in this case</strong>.</p>
</div>
<div class="paragraph">
<p>Run:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Expect an error!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m copy -a 'content="Managed by Ansible\n" dest=/etc/motd'</pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>host1.example.com | FAILED! =&gt; {
    "changed": false,
    "checksum": "a314620457effe3a1db7e02eacd2b3fe8a8badca",
    "failed": true,
    "msg": "Destination /etc not writable"
}</pre>
</div>
</div>
<div class="paragraph">
<p>Should be all red for you, the ad hoc command failed. Why? Because user ansible is not allowed to write the motd file.</p>
</div>
<div class="paragraph">
<p>Now this is a case for privilege escalation and the reason <code>sudo</code> has to be setup properly. We need to instruct ansible to use <code>sudo</code> to run the command as root by using the parameter <code>-b</code> (think "become").</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Ansible will connect to the machines using your current user name (ansible in this case), just like SSH would. To override the remote user name, you could use the <code>-u</code> parameter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For us it&#8217;s okay to connect as ansible because <code>sudo</code> is set up. Change the command to use the <code>-b</code> parameter and run again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m copy -a 'content="Managed by Ansible\n" dest=/etc/motd' -b</pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>host1.example.com | SUCCESS =&gt; {
    "changed": true,
    "checksum": "a314620457effe3a1db7e02eacd2b3fe8a8badca",
    "dest": "/etc/motd",
    "gid": 0,
    "group": "root",
    "md5sum": "7a924f6b4cbcbc7414eda7763dc0e43b",
    "mode": "0644",
    "owner": "root",
    "secontext": "system_u:object_r:etc_t:s0",
    "size": 19,
    "src": "/home/ansible/.ansible/tmp/ansible-tmp-1472132609.82-261447806330276/source",
    "state": "file",
    "uid": 0
}</pre>
</div>
</div>
<div class="paragraph">
<p>Check the motd file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m command -a 'cat /etc/motd'

host1.example.com | SUCCESS | rc=0 &gt;&gt;
Managed by Ansible</pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>ansible host1.example.com -m copy &#8230;&#8203;</code> command from above again. Note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the different output color (proper terminal config provided)</p>
</li>
<li>
<p>the change from <code>"changed": true,</code> to <code>"changed": false,</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This makes it a lot easier to spot changes and what Ansible actually did.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_challenge_lab_modules">4.3. Challenge Lab: Modules</h3>
<div class="ulist">
<ul>
<li>
<p>Using <code>ansible-doc</code></p>
<div class="ulist">
<ul>
<li>
<p>Find a module that uses Yum to manage software packages.</p>
</li>
<li>
<p>Look up the help examples for the module to learn how to install a package in the latest version</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run an Ansible ad hoc command to install the package "screen" in the latest version on host1.example.com</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use the copy ad hoc command from above as a template and change the module and options.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-doc -l | grep -i yum
[ansible@control ansible-files]$ ansible-doc yum
[ansible@control ansible-files]$ ansible host1.example.com -m yum -a 'name=screen state=latest' -b</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_playbooks_introduction">5. Ansible Playbooks: Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While Ansible ad hoc commands are useful for simple operations, they are not suited for complex configuration management or orchestration scenarios.</p>
</div>
<div class="paragraph">
<p>Playbooks are files which describe the desired configurations or steps to implement on managed hosts. Playbooks can change lengthy, complex administrative tasks into easily repeatable routines with predictable and successful outcomes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Here is a nice analogy: When Ansible modules are the tools in your workshop, the inventory is the materials and the Playbooks are the instructions.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_playbook_basics">5.1. Playbook Basics</h3>
<div class="paragraph">
<p>Playbooks are text files written in YAML format and therefore need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to start with three dashes (<code>---</code>)</p>
</li>
<li>
<p>proper identation using spaces and <strong>not</strong> tabs!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are some important concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>hosts</strong>: the managed hosts to perform the tasks on</p>
</li>
<li>
<p><strong>tasks</strong>: the operations to be performed by invoking Ansible modules and passing them the necessary options.</p>
</li>
<li>
<p><strong>become</strong>: privilege escalation in Playbooks, same as using <code>-b</code> in the ad hoc command.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The ordering of the contents within a Playbook is important, because Ansible executes plays and tasks in the order they are presented.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A Playbook should be <strong>idempotent</strong>, so if a Playbook is run once to put the hosts in the correct state, it should be safe to run it a second time and it should make no further changes to the hosts.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Most Ansible modules are idempotent, so it is relatively easy to ensure this is true.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Try to avoid the command, shell, and raw modules in Playbooks. Because these take arbitrary commands, it is very easy to end up with non-idempotent Playbooks with these modules.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_your_first_playbook">6. Your first Playbook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enough theory, it&#8217;s time to create your first Playbook. In this lab you create a Playbook to set up an Apache webserver in three steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First step: Install httpd package</p>
</li>
<li>
<p>Second step: Enable/start httpd service</p>
</li>
<li>
<p>Third step: Create an index.html file</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_playbook_install_apache">6.1. Playbook: Install Apache</h3>
<div class="paragraph">
<p>This Playbook makes sure the package containing the Apache webserver is installed on host1.example.com.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You obviously need to use privilege escalation to install a package or run any other task that requires root permissions. This is done in the Playbook by <code>become: yes</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On control.example.com as user ansible create the file <code>~/ansible-files/apache.yml</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Apache server installed
  hosts: host1.example.com
  become: yes
  tasks:
  - name: latest Apache version installed
    yum:
      name: httpd
      state: latest</pre>
</div>
</div>
<div class="paragraph">
<p>This shows one of Ansible&#8217;s strenghts: The Playbook syntax is easy to read and understand. In this Playbook:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A name is given for the play</p>
</li>
<li>
<p>The host to run against and privilege escalation is configured</p>
</li>
<li>
<p>A task is defined and named, here it uses the module "yum" with the needed options.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_running_playbooks">6.2. Running Playbooks</h3>
<div class="paragraph">
<p>Playbooks are executed using the <code>ansible-playbook</code> command on the control node. Before you run a new Playbook it&#8217;s a good idea to check for syntax errors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook --syntax-check apache.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Now you should be ready to run your Playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook apache.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Use SSH to make sure Apache has been installed on host1.example.com.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ssh host1.example.com rpm -qi httpd

Name        : httpd
Version     : 2.4.6
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>Or even better use an Ansible ad hoc command!</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m command -a 'rpm -qi httpd'</pre>
</div>
</div>
<div class="paragraph">
<p>Run the Playbook a second time.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The different colors, the "ok" and "changed" counters and the "PLAY RECAP" make it easy to spot what Ansible actually did.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_extend_your_playbook_start_enable_apache">6.3. Extend your Playbook: Start &amp; Enable Apache</h3>
<div class="paragraph">
<p>The next part of the Playbook makes sure the Apache webserver is enabled and started on host1.example.com.</p>
</div>
<div class="paragraph">
<p>On control.example.com as user ansible edit the file <code>~/ansible-files/apache.yml</code> to add a second task using the <code>service</code> module. The Playbook should now look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Apache server installed
  hosts: host1.example.com
  become: yes
  tasks:
  - name: latest Apache version installed
    yum:
      name: httpd
      state: latest
  - name: Apache enabled and running
    service:
      name: httpd
      enabled: true
      state: started</pre>
</div>
</div>
<div class="paragraph">
<p>And again what it does is easy to understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a second task is defined</p>
</li>
<li>
<p>a module is specified (<code>service</code>)</p>
</li>
<li>
<p>options are supplied</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As this is YAML take care of the correct indentation when copy/pasting!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run your extended Playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook apache.yml</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Note some tasks are shown as "ok" in green and one is shown as "changed" in yellow.</p>
</li>
<li>
<p>Use an Ansible ad hoc command again to make sure Apache has been enabled and started, e.g. with:
<code>systemctl status httpd</code></p>
</li>
<li>
<p>Run the Playbook a second time to get used to the change in the output.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_extend_your_playbook_create_an_index_html">6.4. Extend your Playbook: Create an index.html</h3>
<div class="paragraph">
<p>Check that the tasks where executed correctly and Apache is accepting connections: Make an HTTP request using Ansible&#8217;s <code>uri</code> module in an ad hoc command from the control node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible localhost -m uri -a "url=http://host1.example.com/"</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Expect a lot of red lines and a 403 status!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As long as there is not at least an <code>index.html</code> file to be served by Apache, it will throw an ugly "HTTP Error 403: Forbidden" status and Ansible will report an error.</p>
</div>
<div class="paragraph">
<p>So why not use Ansible to deploy a simple <code>index.html</code> file? Create the file <code>~/ansible-files/index.html</code> on the control node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;body&gt;
&lt;h1&gt;Apache is running fine&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You already used Ansible&#8217;s <code>copy</code> module to write text supplied on the commandline into a file. Now you&#8217;ll use the module in your Playbook to actually copy a file:</p>
</div>
<div class="paragraph">
<p>On control.example.com as user ansible edit the file <code>~/ansible-files/apache.yml</code> and add a new task utilizing the <code>copy</code> module. It should now look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Apache server installed
  hosts: host1.example.com
  become: yes
  tasks:
  - name: latest Apache version installed
    yum:
      name: httpd
      state: latest
  - name: Apache enabled and running
    service:
      name: httpd
      enabled: true
      state: started
  - name: copy index.html
    copy:
      src: ~/ansible-files/index.html
      dest: /var/www/html/</pre>
</div>
</div>
<div class="paragraph">
<p>You are getting used to the Playbook syntax, so what happens? The new task uses the <code>copy</code> module and defines the source and destination options for the copy operation.</p>
</div>
<div class="paragraph">
<p>Run your extended Playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook apache.yml</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Have a good look at the output</p>
</li>
<li>
<p>Run the ad hoc command using the "uri" module to test Apache again.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The command should now return a friendly green "status: 200" line, amongst other information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_challenge_lab_playbooks">6.5. Challenge Lab: Playbooks</h3>
<div class="paragraph">
<p>This was nice but the real power of Ansible is to apply the same set of tasks reliably to many hosts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the apache.yml Playbook to run on host1 <strong>and</strong> host2.example.com.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There are multiple ways to do this, try to edit the "webserver" group in your inventory file to include both hosts and change your Playbook to use the group in <code>hosts:</code>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the Playbook</p>
</li>
<li>
<p>Test using the ad hoc command with the <code>uri</code> module.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The changed inventory file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[webserver]
host1.example.com
host2.example.com

[database]
host2.example.com

[ftpserver]
host2.example.com</pre>
</div>
</div>
<div class="paragraph">
<p>The Playbook now pointing to the group "webserver":</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Apache server installed
  hosts: webserver
  become: yes
  tasks:
  - name: latest Apache version installed
    yum:
      name: httpd
      state: latest
  - name: Apache enabled and running
    service:
      name: httpd
      enabled: true
      state: started
  - name: copy index.html
    copy:
      src: ~/ansible-files/index.html
      dest: /var/www/html/</pre>
</div>
</div>
<div class="paragraph">
<p>Run the Playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook apache.yml</pre>
</div>
</div>
<div class="paragraph">
<p>And the commands to check if Apache is now running on both servers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible localhost -m uri -a "url=http://host1.example.com/"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible localhost -m uri -a "url=http://host2.example.com/"</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_variables">7. Ansible Variables</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction">7.1. Introduction</h3>
<div class="paragraph">
<p>Ansible supports variables to store values that can be used in Playbooks. Variables can be defined in a variety of places and have a clear precedence. Ansible substitutes the variable with its value when a task is executed.</p>
</div>
<div class="paragraph">
<p><strong>Variables are referenced in Playbooks by placing the variable name in double curly braces.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>Here comes a variable {{ variable1 }}</pre>
</div>
</div>
<div class="paragraph">
<p>The recommended practice is to define variables in files located in two directories named <code>host_vars</code> and <code>group_vars</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To e.g. define variables for a group "servers", create a YAML file named <code>group_vars/servers</code> with the variable definitions.</p>
</li>
<li>
<p>To define variables specifically for a host "host1.example.com", create the file <code>host_vars/host1.example.com</code> with the variable definitions.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Host variables take precedence over group variables (more about precedence can be found in the docs).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_off_to_the_lab">7.2. Off to the Lab</h3>
<div class="paragraph">
<p>For understanding and practice let&#8217;s do a lab. Following up on the theme "Let&#8217;s build a webserver. Or two. Or even more&#8230;&#8203;" you will change the <code>index.html</code> to show the development environment (dev/prod) a server is deployed in.</p>
</div>
<div class="paragraph">
<p>On control.example.com as user ansible create the directories to hold the variable definitions in <code>~/ansible-files/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ mkdir host_vars group_vars</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_variable_files">7.3. Create the Variable Files</h3>
<div class="paragraph">
<p>Now create two files containing variable definitions. We&#8217;ll define a variable named <code>stage</code> which will point to different environments, <code>dev</code> or <code>prod</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>~/ansible-files/group_vars/webserver</code> with this content:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>---
stage: dev</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>~/ansible-files/host_vars/host2.example.com</code>, content:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>---
stage: prod</pre>
</div>
</div>
<div class="paragraph">
<p>What is this about?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For all servers in the <code>webserver</code> group the variable <code>stage</code> with value <code>dev</code> is defined. So as default we flag them as members of the dev environment.</p>
</li>
<li>
<p>For server "host2.example.com" this is overriden and the host is flagged as a production server.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_index_html_files">7.4. Create index.html Files</h3>
<div class="paragraph">
<p>Now create two files in <code>~/ansible-files/</code>:</p>
</div>
<div class="paragraph">
<p>One called <code>prod_index.html</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;body&gt;
&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>And the other called <code>dev_index.html</code> with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;body&gt;
&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_playbook">7.5. Create the Playbook</h3>
<div class="paragraph">
<p>Now you need a Playbook that copies the prod or dev index.html file according to the "stage" variable.</p>
</div>
<div class="paragraph">
<p>Create a new Playbook called <code>deploy_index_html.yml</code> in the <code>~/ansible-files/</code> directory.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note how the variable "stage" is used in the name of the file to copy.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Copy index.html
  hosts: webserver
  become: yes
  tasks:
  - name: copy index.html
    copy:
      src: ~/ansible-files/{{ stage }}_index.html
      dest: /var/www/html/index.html</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the Playbook:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook deploy_index_html.yml</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_the_result">7.6. Test the Result</h3>
<div class="paragraph">
<p>The Playbook should copy different files as index.html to the hosts, use <code>curl</code> to test it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ curl http://host1.example.com

&lt;body&gt;
&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ curl http://host2.example.com

&lt;body&gt;
&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If by now you think: There has to be a smarter way to change content in files&#8230;&#8203; you are absolutely right. This lab was done to introduce variables, you are about to learn about templates in one of the next labs.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_facts">8. Ansible Facts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible facts are variables that are automatically discovered by Ansible from a managed host. Facts are pulled by the <code>setup</code> module and contain useful information stored into variables that administrators can reuse.</p>
</div>
<div class="paragraph">
<p>To get an idea what facts Ansible collects by default, on control.example.com as user ansible from the <code>~/ansible-files/</code> directory run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m setup</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You still remember why you have to run ansible from this directory?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This might be a bit too much, you can use filters to limit the output to certain facts, the expression is shell-style wildcard:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m setup -a 'filter=ansible_eth0'</pre>
</div>
</div>
<div class="paragraph">
<p>Or what about only looking for memory related facts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible all -m setup -a 'filter=ansible_*_mb'</pre>
</div>
</div>
<div class="sect2">
<h3 id="_challenge_lab_facts">8.1. Challenge Lab: Facts</h3>
<div class="ulist">
<ul>
<li>
<p>Try to find and print the distribution (Red Hat) of your managed hosts. On one line, please.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use grep to find the fact, then apply a filter to only print this fact.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m setup | grep distribution</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible all -m setup -a 'filter=ansible_distribution' -o</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_facts_in_playbooks">8.2. Using Facts in Playbooks</h3>
<div class="paragraph">
<p>Facts can be used in a Playbook like variables, using the proper naming, of course. Create this Playbook as <code>facts.yml</code> in the <code>~/ansible-files/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Output facts within a playbook
  hosts: all
  tasks:
  - name: Prints Ansible facts
    debug:
      msg: The default IPv4 address of {{ ansible_fqdn }} is {{ ansible_default_ipv4.address }}</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The "debug" module is handy for e.g. debugging variables or expressions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Execute it to see how the facts are printed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook facts.yml

PLAY [all] *********************************************************************

TASK [setup] *******************************************************************
ok: [host1.example.com]
ok: [host2.example.com]

TASK [Prints various Ansible facts] ********************************************
ok: [host1.example.com] =&gt; {
    "msg": "The default IPv4 address of host1.example.com is 192.168.0.20\n"
}
ok: [host2.example.com] =&gt; {
    "msg": "The default IPv4 address of host2.example.com is 192.168.0.30\n"
}

PLAY RECAP *********************************************************************
host1.example.com          : ok=2    changed=0    unreachable=0    failed=0
host2.example.com          : ok=2    changed=0    unreachable=0    failed=0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_conditionals">9. Ansible Conditionals</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible can use conditionals to execute tasks or plays when certain conditions are met.</p>
</div>
<div class="paragraph">
<p>To implement a conditional, the <code>when</code> statement must be used, followed by the condition to test. The condition is expressed using one of the available operators like e.g. for comparison:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">==</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compares two objects for equality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compares two objects for inequality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true if the left hand side is greater than the right hand side.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true if the left hand side is greater or equal to the right hand side.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true if the left hand side is lower than the right hand side.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt; =</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true if the left hand side is lower or equal to the right hand side.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For more on this, please refer to the documentation: <a href="http://jinja.pocoo.org/docs/2.9/templates/" class="bare">http://jinja.pocoo.org/docs/2.9/templates/</a></p>
</div>
<div class="sect2">
<h3 id="_inventory_group_membership_in_conditional">9.1. Inventory Group Membership in Conditional</h3>
<div class="paragraph">
<p>As an example you would like to install an FTP server, but only on hosts that are in the "ftpserver" inventory group.</p>
</div>
<div class="paragraph">
<p>As user ansible create this Playbook on control.example.com as <code>ftpserver.yml</code> in the <code>~/ansible-files/</code> directory, run it and examine the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Install vsftpd on ftpservers
  hosts: all
  become: yes
  tasks:
    - name: Install FTP server when host in ftpserver group
      yum:
        name: vsftpd
        state: latest
      when: inventory_hostname in groups["ftpserver"]</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The when statement must be placed "outside" of the module by being indented at the top level of the task.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Expected outcome: The task is skipped on host1.example.com because it is not in the ftpserver group in your inventory file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[...]
TASK [Install FTP server when host in ftpserver group] *************************
skipping: [host1.example.com]
changed: [host2.example.com]
[...]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_challenge_lab_fact_in_conditional">9.2. Challenge Lab: Fact in Conditional</h3>
<div class="paragraph">
<p>Admittedly using an inventory group as a condition is the most basic case you would expect to just work. Let&#8217;s try something a bit more interesting:</p>
</div>
<div class="paragraph">
<p>You might have noticed host1 and host2 have different amounts of RAM. If not have another look at the facts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible all -m setup -a 'filter=ansible_*_mb'</pre>
</div>
</div>
<div class="paragraph">
<p>Write a Playbook <code>mariadb.yml</code> that installs MariaDB but only if the host has more then, say, 3000 MB of RAM.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find the fact for memtotal in MB (look at the ad hoc command output and feel free to use "grep").</p>
</li>
<li>
<p>Use this Playbook as a template and create the when statement by <strong>replacing the upper case placeholders</strong>:</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In a <code>when</code> statement facts and variables are <strong>not</strong> to be inclosed in double curly braces like you would do for variables!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: MariaDB server installation
  hosts: all
  become: yes
  tasks:
  - name: Install latest MariaDB server when host RAM greater 3000 MB
    yum:
      name: mariadb-server
      state: latest
    when: FACT COMPARISON_OPERATOR NUMBER</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the Playbook. As a result the installation task should be skipped on host2.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: MariaDB server installation
  hosts: all
  become: yes
  tasks:
  - name: Install latest MariaDB server when host RAM greater 3000 MB
    yum:
      name: mariadb-server
      state: latest
    when: ansible_memtotal_mb &gt; 3000</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_handlers">10. Ansible Handlers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes when a task does make a change to the system, a further task may need to be run. For example, a change to a service&#8217;s configuration file may then require that the service be reloaded so that the changed configuration takes effect.</p>
</div>
<div class="paragraph">
<p>Here Ansible&#8217;s handlers come into play. Handlers can be seen as inactive tasks that only get triggered when explicitly invoked using the "notify" statement.</p>
</div>
<div class="paragraph">
<p>As a an example, let&#8217;s write a Playbook that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>manages Apache&#8217;s configuration file <code>httpd.conf</code> on all hosts in the <code>webserver</code> group</p>
</li>
<li>
<p>restarts Apache when the file has changed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>First we need the file Ansible will deploy, let&#8217;s just take the one from control.example.com:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ cp /etc/httpd/conf/httpd.conf .</pre>
</div>
</div>
<div class="paragraph">
<p>Then create the Playbook <code>httpd_conf.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: manage httpd.conf
  hosts: webserver
  become: yes
  tasks:
  - name: Copy Apache configuration file
    copy:
      src: httpd.conf
      dest: /etc/httpd/conf/
    notify:
       - restart_apache
  handlers:
    - name: restart_apache
      service:
        name: httpd
        state: restarted</pre>
</div>
</div>
<div class="paragraph">
<p>So what&#8217;s new here?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The "notify" section calls the handler only when the copy task changed the file.</p>
</li>
<li>
<p>The "handlers" section defines a task that is only run on notification.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Run the Playbook. We didn&#8217;t change anything in the file yet so there should not be any <code>changed</code> lines in the output and of course the handler shouldn&#8217;t have fired.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Now change the <code>Listen 80</code> line in httpd.conf to:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Listen 8080</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run the Playbook again. Now the Ansible&#8217;s output should be a lot more interesting:</p>
<div class="ulist">
<ul>
<li>
<p>httpd.conf should have been copied over</p>
</li>
<li>
<p>The handler should have restarted Apache</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apache should now listen on port 8080. Easy enough to verify:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ curl http://host2.example.com

curl: (7) Failed connect to host2.example.com:80; Connection refused</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ curl http://host2.example.com:8080

&lt;body&gt;
&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Feel free to change the httpd.conf file again and run the Playbook.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_templates">11. Ansible Templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible uses Jinja2 templating to modify files before they are distributed to managed hosts. Jinja2 is one of the most used template engines for Python (<a href="http://jinja.pocoo.org/" class="bare">http://jinja.pocoo.org/</a>).</p>
</div>
<div class="sect2">
<h3 id="_using_templates_in_playbooks">11.1. Using Templates in Playbooks</h3>
<div class="paragraph">
<p>When a template for a file has been created, it can be deployed to the managed hosts using the <code>template</code> module, which supports the transfer of a local file from the control node to the managed hosts.</p>
</div>
<div class="paragraph">
<p>As an example of using templates you will change the motd file to contain host-specific data.</p>
</div>
<div class="paragraph">
<p>In the <code>~/ansible-files/</code> directory on control.example.com as user ansible create the template file <code>motd-facts.j2</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to {{ ansible_hostname }}.
{{ ansible_distribution }} {{ ansible_distribution_version}}
deployed on {{ ansible_architecture }} architecture.</pre>
</div>
</div>
<div class="paragraph">
<p>In the <code>~/ansible-files/</code> directory on control.example.com as user ansible create the Playbook <code>motd-facts.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: Fill motd file with host data
  hosts: host1.example.com
  become: yes
  tasks:
    - template:
        src: motd-facts.j2
        dest: /etc/motd
        owner: root
        group: root
        mode: 0644</pre>
</div>
</div>
<div class="paragraph">
<p>You have done this a couple of times by now:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Understand what the Playbook does.</p>
</li>
<li>
<p>Execute the Playbook <code>motd-facts.yml</code></p>
</li>
<li>
<p>Login to host1.example.com via SSH and check the motto of the day message.</p>
</li>
<li>
<p>Log out of host1.example.com</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should see how Ansible replaces the variables with the facts it discovered from the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_challenge_lab">11.2. Challenge Lab</h3>
<div class="paragraph">
<p>Change the template to use the FQDN hostname:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Find a fact that contains the fully qualified hostname using the commands you learned in the "Ansible Facts" chapter.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Do a <code>grep -i</code> for fqdn
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the template to use the fact you found.</p>
</li>
<li>
<p>Run the Playbook again.</p>
</li>
<li>
<p>Check motd by logging in to host1.example.com</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Find the fact:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible host1.example.com -m setup | grep -i fqdn</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>ansible_fqdn</code> fact in the template <code>motd-facts.j2</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_end">12. The End</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Congratulations, you finished your labs! We hope you enjoyed your first steps using Ansible as much as we enjoyed creating the labs.</p>
</div>
<div class="paragraph">
<p>But it doesn&#8217;t have to end here. We prepared some slightly more advanced bonus labs for you to follow through if you like.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bonus_labs">13. Bonus Labs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are done with the labs and still have some time, here are some more labs for you:</p>
</div>
<div class="sect2">
<h3 id="_bonus_lab_ad_hoc_commands">13.1. Bonus Lab: Ad Hoc Commands</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new user "testuser" on host1 and host2 using an ad hoc command</p>
<div class="ulist">
<ul>
<li>
<p>Find the parameters for the appropriate module using <code>ansible-doc user</code> (leave with <code>q</code>)</p>
</li>
<li>
<p>Use an Ansible ad hoc command to create the user with the comment "Test D User"</p>
</li>
<li>
<p>Use the "command" module with the proper invocation to find the userid</p>
</li>
</ul>
</div>
</li>
<li>
<p>Delete the user and check it has been deleted</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Remember privilege escalation&#8230;&#8203;
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your commands could look like these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-doc -l | grep -i user
[ansible@control ansible-files]$ ansible-doc user
[ansible@control ansible-files]$ ansible all -m user -a "name=testuser comment='Test D User'" -b
[ansible@control ansible-files]$ ansible all -m command -a " id testuser" -b
[ansible@control ansible-files]$ ansible all -m user -a "name=testuser state=absent remove=yes" -b
[ansible@control ansible-files]$ ansible all -m command -a " id testuser" -b</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_lab_templates_and_variables">13.2. Bonus Lab: Templates and Variables</h3>
<div class="paragraph">
<p>You have learned the basics about Ansible templates, variables and handlers. Let&#8217;s combine all of these.</p>
</div>
<div class="paragraph">
<p>Instead of editing and copying <code>httpd.conf</code> why don&#8217;t you just define a variable for the listen port and use it in a template? Here is your job:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define a variable "listen_port" for the <code>webserver</code> group with the value "8080" and another for <code>host2.example.com</code> with the value "80" using the proper files.</p>
<div class="ulist">
<ul>
<li>
<p>Remember the <code>group_vars</code> and <code>host_vars</code> directories? If not, refer to the chapter "Ansible Variables".</p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the <code>httpd.conf</code> file into the template <code>httpd.conf.j2</code> that uses the <code>listen_port</code> variable instead of the hard-coded port number.</p>
</li>
<li>
<p>Write a Playbook that deploys the template and restarts Apache on changes using a handler.</p>
</li>
<li>
<p>Run the Playbook and test the result using "curl".</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_define_the_variables">13.2.1. Define the variables:</h4>
<div class="ulist">
<ul>
<li>
<p>Add this line to <code>group_vars/webserver</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>listen_port: 8080</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add this line to <code>host_vars/host2.example.com</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>listen_port: 80</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prepare_the_template">13.2.2. Prepare the template:</h4>
<div class="ulist">
<ul>
<li>
<p>Copy <code>httpd.conf</code> to <code>httpd.conf.j2</code></p>
</li>
<li>
<p>Edit the "Listen" directive in <code>httpd.conf.j2</code> to make it look like this:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[...]
Listen {{ listen_port }}
[...]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_the_playbook_code_apache_config_tpl_yml_code">13.2.3. Create the Playbook <code>apache_config_tpl.yml</code>:</h4>
<div class="listingblock">
<div class="content">
<pre>---
- name: Apache httpd.conf
  hosts: webserver
  become: yes
  tasks:
  - name: Create Apache configuration file from template
    template:
      src: httpd.conf.j2
      dest: /etc/httpd/conf/httpd.conf
    notify:
       - restart apache
  handlers:
    - name: restart apache
      service:
        name: httpd
        state: restarted</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_run_and_test">13.2.4. Run and test:</h4>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook apache_config_tpl.yml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ curl http://host2.example.com:80
&lt;body&gt;
&lt;h1&gt;This is a production webserver, take care!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ curl http://host1.example.com:8080
&lt;body&gt;
&lt;h1&gt;This is a development webserver, have fun!&lt;/h1&gt;
&lt;/body&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_a_configuration_file">13.3. Change a Configuration File</h3>
<div class="paragraph">
<p>This lab is about how to automate a pretty common sys admin task: Make sure a configuration file setting is configured in a certain way. As an example let&#8217;s make sure the SSH daemon is not accepting direct root logins.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll need to learn about a new module; <code>lineinfile</code>. Here is your job:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read the <code>lineinfile</code> doc</p>
</li>
<li>
<p>Copy <code>apache_config_tpl.yml</code> to <code>no_sshd_root.yml</code> and adapt it to:</p>
<div class="ulist">
<ul>
<li>
<p>Use the module <code>lineinfile</code> with these parameters:</p>
<div class="ulist">
<ul>
<li>
<p>Use the <code>dest</code> option to specify the config file (<code>/etc/ssh/sshd_config</code>)</p>
</li>
<li>
<p>Use the <code>line</code> option to provide the proper config file value (use <code>"PermitRootLogin no"</code>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Configure a handler <code>restart_sshd</code> to restart <code>sshd</code> when the configuration was changed.</p>
</li>
<li>
<p>Test the SSH login as root, the password is the same as for everything else.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>Solution below!</strong>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the Playbook <code>no_sshd_root.yml</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>---
- name: no root login to sshd
  hosts: all
  become: yes
  tasks:
  - name: change sshd config file
    lineinfile:
      dest: /etc/ssh/sshd_config
      line: "PermitRootLogin no"
    notify:
       - restart_ssh
  handlers:
    - name: restart_ssh
      service:
        name: sshd
        state: restarted</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Run it and check the SSH login as root:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ansible-playbook no_sshd_root.yml</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[ansible@control ansible-files]$ ssh root@host1.example.com
root@host1.example.com's password:
Permission denied, please try again.</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-05-22 14:42:38 CEST
</div>
</div>
</body>
</html>